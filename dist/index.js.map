{"version":3,"sources":["../src/providers/asterai.provider.ts","../src/environment.ts","../src/actions/query.ts","../src/index.ts"],"sourcesContent":["import {\n    elizaLogger,\n    type IAgentRuntime,\n    type Memory,\n    type Provider,\n    type State, type UUID,\n} from \"@elizaos/core\";\nimport {validateAsteraiConfig} from \"../environment.ts\";\nimport {getInitAsteraiClient} from \"../index.ts\";\n\nconst asteraiProvider: Provider = {\n    get: async (\n        runtime: IAgentRuntime,\n        message: Memory,\n        _state?: State\n    ): Promise<string | null> => {\n        const hasConfiguredEnv =\n          !!runtime.getSetting(\"ASTERAI_AGENT_ID\") &&\n          !!runtime.getSetting(\"ASTERAI_PUBLIC_QUERY_KEY\");\n        if (!hasConfiguredEnv) {\n            elizaLogger.error(\n                \"ASTERAI_AGENT_ID or ASTERAI_PUBLIC_QUERY_KEY \" +\n                \"not configured, skipping provider\"\n            );\n            return null;\n        }\n        const config = await validateAsteraiConfig(runtime);\n        const asteraiClient = getInitAsteraiClient(\n          config.ASTERAI_AGENT_ID,\n          config.ASTERAI_PUBLIC_QUERY_KEY\n        );\n        if (!asteraiClient) {\n            elizaLogger.error(\"asteraiClient is not initialised\");\n            return null;\n        }\n        const agentId = runtime.getSetting(\"ASTERAI_AGENT_ID\") as UUID;\n        let agentSummaryMemory = await runtime.knowledgeManager.getMemoryById(agentId);\n        if (!agentSummaryMemory) {\n            // Fetch & set summary memory.\n            const summary = await asteraiClient.fetchSummary();\n            elizaLogger.debug(\"asterai agent summary fetched:\", summary);\n            await runtime.knowledgeManager.createMemory({\n                id: agentId,\n                userId: message.userId,\n                agentId: message.agentId,\n                roomId: message.roomId,\n                createdAt: Date.now(),\n                content: {\n                    text: summary\n                }\n            });\n            agentSummaryMemory = await runtime.knowledgeManager.getMemoryById(agentId);\n        }\n        if (!agentSummaryMemory) {\n            elizaLogger.error(\"failed to initialise agent's summary memory\");\n            return null;\n        }\n        return agentSummaryMemory.content.text;\n    },\n};\n\n// Module exports\nexport { asteraiProvider };\n","import type { IAgentRuntime } from \"@elizaos/core\";\nimport { z } from \"zod\";\n\nconst envSchema = z.object({\n    ASTERAI_AGENT_ID: z\n        .string()\n        .min(1, \"ASTERAI_AGENT_ID is required\"),\n    ASTERAI_PUBLIC_QUERY_KEY: z\n        .string()\n        .min(1, \"ASTERAI_PUBLIC_QUERY_KEY is required\"),\n});\n\nexport type AsteraiConfig = z.infer<typeof envSchema>;\n\nexport async function validateAsteraiConfig(\n    runtime: IAgentRuntime\n): Promise<AsteraiConfig> {\n    try {\n        const config = {\n            ASTERAI_AGENT_ID:\n                runtime.getSetting(\"ASTERAI_AGENT_ID\") ||\n                process.env.ASTERAI_AGENT_ID,\n            ASTERAI_PUBLIC_QUERY_KEY:\n                runtime.getSetting(\"ASTERAI_PUBLIC_QUERY_KEY\") || process.env.ASTERAI_PUBLIC_QUERY_KEY,\n        };\n\n        return envSchema.parse(config);\n    } catch (error) {\n        if (error instanceof z.ZodError) {\n            const errorMessages = error.errors\n                .map((err) => `${err.path.join(\".\")}: ${err.message}`)\n                .join(\"\\n\");\n            throw new Error(\n                `Asterai plugin configuration validation failed:\\n${errorMessages}`\n            );\n        }\n        throw error;\n    }\n}\n","import {\n    elizaLogger,\n    type Action,\n    type ActionExample,\n    type HandlerCallback,\n    type IAgentRuntime,\n    type Memory,\n    type State,\n} from \"@elizaos/core\";\nimport { validateAsteraiConfig } from \"../environment\";\nimport {getInitAsteraiClient} from \"../index.ts\";\n\nexport const queryAction = {\n    name: \"QUERY_ASTERAI_AGENT\",\n    similes: [\n        \"MESSAGE_ASTERAI_AGENT\",\n        \"TALK_TO_ASTERAI_AGENT\",\n        \"SEND_MESSAGE_TO_ASTERAI_AGENT\",\n        \"COMMUNICATE_WITH_ASTERAI_AGENT\",\n    ],\n    description:\n        \"Call this action to send a message to the asterai agent which \" +\n        \"has access to external plugins and functionality to answer \" +\n        \"the user you are assisting, to help perform a workflow task, etc.\",\n    validate: async (runtime: IAgentRuntime, _message: Memory) => {\n        const config = await validateAsteraiConfig(runtime);\n        getInitAsteraiClient(\n          config.ASTERAI_AGENT_ID,\n          config.ASTERAI_PUBLIC_QUERY_KEY\n        );\n        return true;\n    },\n    handler: async (\n        runtime: IAgentRuntime,\n        message: Memory,\n        _state: State,\n        _options: { [key: string]: unknown },\n        callback?: HandlerCallback\n    ): Promise<boolean> => {\n        const config = await validateAsteraiConfig(runtime);\n        const asteraiClient = getInitAsteraiClient(\n          config.ASTERAI_AGENT_ID,\n          config.ASTERAI_PUBLIC_QUERY_KEY\n        );\n        elizaLogger.debug(\"called QUERY_ASTERAI_AGENT action with message:\", message.content);\n        const response = await asteraiClient.query({\n            query: message.content.text\n        });\n        const textResponse = await response.text();\n        callback({\n            text: textResponse\n        });\n        return true;\n    },\n    examples: [\n        [\n            {\n                user: \"{{user1}}\",\n                content: {\n                    text: \"How's the weather in LA?\",\n                },\n            },\n            {\n                user: \"{{user2}}\",\n                content: {\n                    text: \"Let me check that for you, just a moment.\",\n                    action: \"QUERY_ASTERAI_AGENT\",\n                },\n            },\n        ],\n    ] as ActionExample[][],\n} as Action;\n","import {asteraiProvider} from \"./providers/asterai.provider.ts\";\nimport type { Plugin } from \"@elizaos/core\";\nimport { queryAction } from \"./actions/query\";\nimport { AsteraiClient } from \"@asterai/client\";\n\nexport * from \"./environment\";\nexport * from \"./providers/asterai.provider\";\n\nlet asteraiClient: AsteraiClient | null = null;\n\nexport const getInitAsteraiClient = (\n  agentId: string,\n  publicQueryKey: string\n): AsteraiClient => {\n    if (!asteraiClient) {\n        asteraiClient = new AsteraiClient({\n            appId: agentId,\n            queryKey: publicQueryKey,\n        })\n    }\n    return asteraiClient;\n};\n\nexport const asteraiPlugin: Plugin = {\n    name: \"asterai\",\n    description: \"asterai Plugin for Eliza\",\n    providers: [asteraiProvider],\n    actions: [queryAction],\n    evaluators: [],\n    services: [],\n};\n\nexport default asteraiPlugin;\n"],"mappings":"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","names":["asteraiClient","elizaLogger","asteraiClient","elizaLogger"]}